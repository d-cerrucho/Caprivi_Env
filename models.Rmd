---
title: "models"
author: "Diego"
date: "2023-02-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

MODELS

---
title: "models"
author: "Diego"
date: "2023-01-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


#Merge all date from river leves and area flooded with water
```{r}
rios_chau <- read_csv("rios_chau.csv")
rios_kat <- read_csv("rios_kat.csv")
load("~/Caprivi_env/Caprivi_Env/data.Rdata")

#filtrate river chauvama data for 2018 and avobe
rios_chau %>% filter(year > 2017) -> rios_chau
```
##filtrate water data for months 1-8

```{r}
#filtrate water data for months 1-8
data$year<-as.numeric(as.character(data$year))
data %>% filter(month < 9 & year > 2017) -> data
data %>% 
   mutate(dates = make_date(year = data$year, month = data$month, day = data$day)) -> data

str(rios_chau)
str(rios_kat)
str(data)
```

##Merge

```{r}
#Merge
all_data<-merge (rios_chau , rios_kat, by= "dates")
all_data<-merge(all_data, data, by ="dates", all=TRUE)
#clean db

all_data %>% 
  select(-year.x,-day.x,-month.x,-year.y,-day.y,-month.y,-...1.y,-...1.x) -> all_data

# corregir datos de ano, mes y dia
all_data %>% 
   mutate(
    year = factor(year(dates)),
    month = month(dates),
    day = day(dates)
   ) %>%
  select(-date) -> all_data


# agregar una columna de water_agua interpolando para dias sin dato

library(chillR)
water_int<-interpolate_gaps(all_data[,"water_area"])
all_data[,"water_int"]<-water_int$interp
all_data[,"water_interpolated"]<-water_int$missing
```

#Una vez completada la base de datos completa, los almacenamos en un archivo ".Rdata". De esta manera, podremos utilizarlos desde cualquier otro script.

```{r load-data}
save(all_data, data, file = "all_data.Rdata")
load(here("all_data.Rdata"))
```

# figure of rivers and water area together aling the years to have a first view of how they follow each otehr and rought delay estimates

```{r}
#convert values to realtive for rivers and water
all_data$cauv_rel<-all_data$cauv_flow/max(all_data$cauv_flow)
all_data$kat_rel<-all_data$kat_heigt/max(all_data$kat_heigt)
all_data$water_rel<-all_data$water_int/max(all_data$water_int)
all_data$water_rel_p<-all_data$water_area/max(all_data$water_area, na.rm = TRUE)

plot1<-all_data %>% 
  ggplot() + geom_line(aes(x=dates,y=kat_rel),color='red') + 
             geom_line(aes(x=dates,y=cauv_rel),color='green') + 
             geom_line(aes(x=dates,y=water_rel),color='blue') + 
             geom_point(aes(x=dates,y=water_rel_p),color='black', na.rm = TRUE) + 
           ylab('Values')+xlab('dates')
plot(plot1)

```
# figure of rivers and water area together aling the years to have a first view of how they follow each otehr and rought delay estimates== river data transformed to katima height/10 and chauvama flow to /10000

```{r}
#convert values to realtive for rivers and water
all_data$cauv_div<-all_data$cauv_flow/10000
all_data$kat_div<-all_data$kat_heigt/10
all_data$water_rel<-all_data$water_int/max(all_data$water_int)
all_data$water_rel_p<-all_data$water_area/max(all_data$water_area, na.rm = TRUE)

plot2<-all_data %>% 
  ggplot() + geom_line(aes(x=dates,y=kat_div),color='red') + 
             geom_line(aes(x=dates,y=cauv_div),color='green') + 
             geom_line(aes(x=dates,y=water_rel),color='blue') + 
             geom_point(aes(x=dates,y=water_rel_p),color='black', na.rm = TRUE) + 
           ylab('Values')+xlab('dates')
plot(plot2)

```

